
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Running Substrate tweaks in the iOS Simulator - sharedInstance</title>
  <meta name="author" content="sharedInstance">

  
  <meta name="description" content="With the iPhone 4 being the last iOS 7 device standing that can be jailbroken tethered, it&rsquo;s gotten much harder to test and update tweaks for &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sharedinstance.net/2013/10/running-tweaks-in-simulator">
  <link rel="icon" href="/favicon.png?rev=2">
  <link rel="stylesheet" href="/stylesheets/screen.css">
  <link rel="alternate" href="/atom.xml" title="sharedInstance" type="application/atom+xml">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:700|Source+Code+Pro:400,700">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28374943-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sharedInstance</a></h1>
  <p><a href="#navigation" title="Navigation" id="js-navbutton">&#x2261;</a></p>
</hgroup>

</header>
  <nav role="navigation">
    <div class="container">  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sharedinstance.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>

<div class="clear"></div>
</div>
  </nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Running Substrate tweaks in the iOS Simulator</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-21'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           &mdash; <a href="#disqus_thread"
             data-disqus-identifier="http://sharedinstance.net">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>With the iPhone 4 being the last iOS 7 device standing that can be jailbroken tethered, it&rsquo;s gotten much harder to test and update tweaks for the new firmware ahead of the untethered jailbreak release.</p>

<p>But there&rsquo;s still a way to do this if you&rsquo;re on a Mac. The iOS Simulator is basically already jailbroken, in the sense that you can access its filesystem and not all security policies are enforced. Therefore you can test your SpringBoard tweaks on iOS 7 with the simulator.</p>

<!--more-->


<p>Do keep in mind that this will only work with tweaks that only need to load into SpringBoard or other daemons. If you want to test a tweak inside apps, unfortunately you&rsquo;ll need to wait for a proper Substrate for OS X release that can do this.</p>

<h3>Installing</h3>

<p>First, you need to install Substrate. The binaries in the Substrate package in Cydia (except for MobileSafety) are compiled for both armv6 and i386/x86_64, so you can simply download, extract, and copy the files out of the package like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://apt.saurik.com/debs/mobilesubstrate_0.9.4001_iphoneos-arm.deb
</span><span class='line'>mkdir substrate
</span><span class='line'>dpkg-deb -x mobilesubstrate_0.9.4001_iphoneos-arm.deb substrate
</span><span class='line'>sudo mv substrate/Library/Frameworks/CydiaSubstrate.framework /Library/Frameworks/CydiaSubstrate.framework
</span><span class='line'>sudo mv substrate/Library/MobileSubstrate /Library/MobileSubstrate
</span><span class='line'>sudo mv substrate/usr/lib/* /usr/lib
</span></code></pre></td></tr></table></div></figure>


<h3>Injecting</h3>

<p>Awesome, now we need to get it to inject into the iOS Simulator. As of iOS 7, SpringBoard is launched by <code>launchd_sim</code> instead of directly by the simulator binary, so the hack that many people used in the past no longer works. However, you can still use Substrate by manually modifying LaunchDaemon plists found in the SDK.</p>

<p>Head over to the <code>LaunchDaemons</code> directory of the simulator&rsquo;s sysroot on your Mac:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator7.0.sdk/System/Library/LaunchDaemons
</span></code></pre></td></tr></table></div></figure>


<p>Make a backup of <code>com.apple.SpringBoard.plist</code> somewhere other than the LaunchDaemons directory (otherwise SpringBoard will be loaded twice).</p>

<p>Now open the original plist in your favorite text or plist editor (Xcode has one built in). It&rsquo;s a binary plist, so if your text editor isn&rsquo;t cool enough to convert it to XML automatically, you can do so with <code>plutil -convert xml1 com.apple.SpringBoard.plist</code>. Add an <code>EnvironmentVariables</code> key, and set its value to a dictionary containing <code>DYLD_INSERT_LIBRARIES</code>, and set the value of that to the location of your dylib (<em>not MobileSubstrate.dylib</em>).</p>

<p>You should end up with something like this:</p>

<p><img src="http://cdn.hbang.ws/sharedinstance/wp-content/uploads/2013/10/Screen-Shot-2013-10-20-at-9.58.32-PM-1.png" alt="Modified com.apple.SpringBoard.plist" /></p>

<p>If you have the simulator running, close and re-launch it for the changes to apply.</p>

<h3>Environment</h3>

<p>Next, you must export <code>$IPHONE_SIMULATOR_ROOT</code>. Open <code>~/.bash_profile</code> (or the equivalent for your shell) and add:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">IPHONE_SIMULATOR_ROOT</span><span class="o">=</span>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator7.0.sdk
</span></code></pre></td></tr></table></div></figure>


<p>Load the changes into your shell by executing <code>. ~/.bash_profile</code>, or just close and launch a new shell.</p>

<p>Finally, you need to make a minor modification to theos, since the iOS 7 SDK&rsquo;s ld doesn&rsquo;t like one of the flags that theos passes to it. Open <code>$THEOS/makefiles/targets/Darwin/simulator.mk</code> in your editor, and find the following line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='make'><span class='line'><span class="nv">_TARGET_OSX_VERSION_FLAG</span> <span class="o">=</span> -mmacosx-version-min<span class="o">=</span><span class="k">$(if</span> <span class="k">$(</span>_TARGET_VERSION_GE_4_0<span class="k">)</span>,10.6,10.5<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Replace it with this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='make'><span class='line'><span class="nv">_TARGET_VERSION_GE_7_0</span> <span class="o">=</span> <span class="k">$(</span>call __simplify,_TARGET_VERSION_GE_7_0,<span class="k">$(</span>shell <span class="k">$(</span>THEOS_BIN_PATH<span class="k">)</span>/vercmp.pl <span class="k">$(</span>_THEOS_TARGET_SDK_VERSION<span class="k">)</span> ge 7.0<span class="k">))</span>
</span><span class='line'><span class="nv">_TARGET_OSX_VERSION_FLAG</span> <span class="o">=</span> <span class="k">$(if</span> <span class="k">$(</span>_TARGET_VERSION_GE_7_0<span class="k">)</span>,-miphoneos-version-min<span class="o">=</span>7.0,-mmacosx-version-min<span class="o">=</span><span class="k">$(if</span> <span class="k">$(</span>_TARGET_VERSION_GE_4_0<span class="k">)</span>,10.6,10.5<span class="k">))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Linking</h3>

<p>Your copy of <code>libsubstrate.dylib</code> won&rsquo;t be able to be linked against, since it doesn&rsquo;t have a slice for the iOS Simulator platform. You can download a version that does like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mv <span class="nv">$THEOS</span>/lib/libsubstrate.dylib <span class="nv">$THEOS</span>/lib/libsubstrate.dylib_
</span><span class='line'>wget http://cdn.hbang.ws/dl/libsubstrate_ios7sim.dylib -O <span class="nv">$THEOS</span>/lib/libsubstrate.dylib
</span></code></pre></td></tr></table></div></figure>


<p>Note that this only contains an x86_64 slice for OS X, since it isn&rsquo;t possible to have multiple i386 slices. However, you won&rsquo;t need to worry about this unless you have OS X projects that depend on OS X 10.5 or older.</p>

<h3>Compiling</h3>

<p>Simply compiling tweaks like normal is not enough for them to work in the simulator: in this case, they&rsquo;ll be compiled for the ARM architecture, and your Mac runs on Intel. It&rsquo;s fairly simple to do this with theos, however, by setting the <code>TARGET</code> variable.</p>

<p>If you don&rsquo;t already have <code>TARGET</code> set in your makefile, at the top of your makefile, add this line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='make'><span class='line'><span class="nv">TARGET</span> <span class="o">=</span> simulator
</span></code></pre></td></tr></table></div></figure>


<p>If you do, set the target parameter to <code>simulator</code>. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='make'><span class='line'><span class="nv">TARGET</span> <span class="o">=</span> simulator:clang:7.0
</span></code></pre></td></tr></table></div></figure>


<p><small>(Check out <a href="https://github.com/theiostream/theos-ref/blob/master/2_1_1_5_0_TARGET.md">theiostream&rsquo;s documentation on TARGET</a> if you haven&rsquo;t tried it before.)</small></p>

<h3>That&rsquo;s it!</h3>

<p>You can now run make, ignoring the warning that ld whines about. SpringBoard will not be restarted for you, like usual – you must execute <code>killall SpringBoard</code> yourself.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">FTO and kirb</span></span>
 &mdash;
      




<time class='entry-date' datetime='2013-10-21'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time> &mdash;
      

<span class="categories">
  
    <a class='category' href='/categories/sbblog/'>sbblog</a>
  
</span>


    </p>
    <p class="meta">
      
        <a class="basic-alignment left" href="/2013/10/welcome-to-sharedinstance/" title="Previous Post: Welcome to sharedInstance!">&laquo; Welcome to sharedInstance!</a>
      
      
        <a class="basic-alignment right" href="/2013/12/build-on-windows/" title="Next Post: How to build jailbreak packages for iOS on Windows">How to build jailbreak packages for iOS on Windows &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013&ndash;2015, sharedInstance &mdash;
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script>
      var disqus_shortname = 'sharedinstance';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sharedinstance.net/2013/10/running-tweaks-in-simulator/';
        var disqus_url = 'http://sharedinstance.net/2013/10/running-tweaks-in-simulator/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<script src="/javascripts/$.js"></script>
<script src="/javascripts/script.js"></script>


</body>
</html>
